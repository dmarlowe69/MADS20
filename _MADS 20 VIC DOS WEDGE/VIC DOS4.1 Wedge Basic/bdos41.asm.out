BDOS41.ASM......PAGE 0001

LINE# LOC   CODE        LINE































































DOS 4.1 DISK WEDGE......PAGE 0002

LINE# LOC   CODE        LINE


00003  0000              ;*********************************
00004  0000              ;* = $0401   ; 3K EXPANSION
00005  0000              ;* = $1001   ; NO EXPANSION
00006  0000              *      = $1201         ; 32K EXPANSION
00007  1201              ;* = $BC00   ; SYS 48128
00008  1201              ;*********************************
00009  1201              ;
00010  1201              ;       DOS 4.1 DISK WEDGE
00011  1201              ;
00012  1201              ;      VERSION V4.1/071382
00013  1201              ;      BY BOB FAIRBAIRN
00014  1201              ;        COPYRIGHT 1982
00015  1201              ;  COMMODORE BUSINESS MACHINES
00016  1201              ;
00017  1201              ;  DOCUMENTED BY DENTON MARLOWE
00018  1201              ;
00019  1201              ;*********************************
00020  1201              ; BASIC STUB
00021  1201              ;*********************************
00022  1201              ;10 PRINT".CLEAR."TAB(6)".REVERSE.VIC WEDGE
00023  1201              ;20 PRINT".DOWN.   BY DAVID A. HOOK
00024  1201              ;30 PRINT".DOWN. >        DISK STATUS
00025  1201              ;40 PRINT" @         OR COMMAND
00026  1201              ;50 PRINT">$0       DIRECTORY"
00027  1201              ;60 PRINT" @$0
00028  1201              ;70 PRINT".DOWN./FILENAME    LOAD
00029  1201              ;80 SYS(PEEK(43)+256*PEEK(44)+215)
00030  1201              ;90 NEW
00031  1201              ;*********************************
00032  1201              ;10 PRINT".CLEAR."TAB(6)".REVERSE.VIC WEDGE
00033  1201  18 04              .WORD $0418
00034  1203  0A 00              .WORD $000A
00035  1205  99                 .BYTE $99,$22,$93,$22,$A3,$36,$29,$22
00035  1206  22 
00035  1207  93 
00035  1208  22 
00035  1209  A3 
00035  120A  36 
00035  120B  29 
00035  120C  22 
00036  120D  12                 .BYTE $12,$56,$49,$43,$20,$57,$45,$44
00036  120E  56 
00036  120F  49 
00036  1210  43 
00036  1211  20 
00036  1212  57 
00036  1213  45 
00036  1214  44 
00037  1215  47                 .BYTE $47,$45
00037  1216  45 
00038  1217  00                 .BYTE $00
00039  1218              ;20 PRINT".DOWN.   BY DAVID A. HOOK
00040  1218  33 04              .WORD $0433
00041  121A  14 00              .WORD $0014
00042  121C  99                 .BYTE $99,$22,$11,$20,$20,$20,$42,$59






DOS 4.1 DISK WEDGE......PAGE 0003

LINE# LOC   CODE        LINE


00042  121D  22 
00042  121E  11 
00042  121F  20 
00042  1220  20 
00042  1221  20 
00042  1222  42 
00042  1223  59 
00043  1224  20                 .BYTE $20,$44,$41,$56,$49,$44,$20,$41
00043  1225  44 
00043  1226  41 
00043  1227  56 
00043  1228  49 
00043  1229  44 
00043  122A  20 
00043  122B  41 
00044  122C  2E                 .BYTE $2E,$20,$48,$4F,$4F,$4B
00044  122D  20 
00044  122E  48 
00044  122F  4F 
00044  1230  4F 
00044  1231  4B 
00045  1232  00                 .BYTE $00
00046  1233              ;30 PRINT".DOWN. >        DISK STATUS
00047  1233  50 04              .WORD $0450
00048  1235  1E 00              .WORD $001E
00049  1237  99                 .BYTE $99,$22,$11,$3E,$20,$20,$20,$20
00049  1238  22 
00049  1239  11 
00049  123A  3E 
00049  123B  20 
00049  123C  20 
00049  123D  20 
00049  123E  20 
00050  123F  20                 .BYTE $20,$20,$20,$20,$20,$44,$49,$53
00050  1240  20 
00050  1241  20 
00050  1242  20 
00050  1243  20 
00050  1244  44 
00050  1245  49 
00050  1246  53 
00051  1247  4B                 .BYTE $4B,$20,$53,$54,$41,$54,$55,$53
00051  1248  20 
00051  1249  53 
00051  124A  54 
00051  124B  41 
00051  124C  54 
00051  124D  55 
00051  124E  53 
00052  124F  00                 .BYTE $00
00053  1250              ;40 PRINT" @         OR COMMAND
00054  1250  6C 04              .WORD $046C
00055  1252  28 00              .WORD $0028
00056  1254  99                 .BYTE $99,$22,$40,$20,$20,$20,$20,$20
00056  1255  22 






DOS 4.1 DISK WEDGE......PAGE 0004

LINE# LOC   CODE        LINE


00056  1256  40 
00056  1257  20 
00056  1258  20 
00056  1259  20 
00056  125A  20 
00056  125B  20 
00057  125C  20                 .BYTE $20,$20,$20,$20,$4F,$52,$20,$43
00057  125D  20 
00057  125E  20 
00057  125F  20 
00057  1260  4F 
00057  1261  52 
00057  1262  20 
00057  1263  43 
00058  1264  4F                 .BYTE $4F,$4D,$4D,$41,$4E,$44,$53       
00058  1265  4D 
00058  1266  4D 
00058  1267  41 
00058  1268  4E 
00058  1269  44 
00058  126A  53 
00059  126B  00                 .BYTE $00
00060  126C              ;50 PRINT">$0       DIRECTORY"
00061  126C  89 04              .WORD $0489
00062  126E  32 00              .WORD $0032
00063  1270  99                 .BYTE $99,$22,$11,$3E,$24,$30,$20,$20
00063  1271  22 
00063  1272  11 
00063  1273  3E 
00063  1274  24 
00063  1275  30 
00063  1276  20 
00063  1277  20 
00064  1278  20                 .BYTE $20,$20,$20,$20,$20,$20,$20,$44
00064  1279  20 
00064  127A  20 
00064  127B  20 
00064  127C  20 
00064  127D  20 
00064  127E  20 
00064  127F  44 
00065  1280  49                 .BYTE $49,$52,$45,$43,$54,$4F,$52,$59
00065  1281  52 
00065  1282  45 
00065  1283  43 
00065  1284  54 
00065  1285  4F 
00065  1286  52 
00065  1287  59 
00066  1288  00                 .BYTE $00
00067  1289              ;60 PRINT" @$0
00068  1289  93 04              .WORD $0493
00069  128B  3C 00              .WORD $003C
00070  128D  99                 .BYTE $99,$22,$40,$24,$30
00070  128E  22 






DOS 4.1 DISK WEDGE......PAGE 0005

LINE# LOC   CODE        LINE


00070  128F  40 
00070  1290  24 
00070  1291  30 
00071  1292  00                 .BYTE $00
00072  1293              ;70 PRINT".DOWN./FILENAME    LOAD
00073  1293  B0 04              .WORD $04B0
00074  1295  46 00              .WORD $0046
00075  1297  99                 .BYTE $99,$22,$11,$2F,$46,$49,$4C,$45
00075  1298  22 
00075  1299  11 
00075  129A  2F 
00075  129B  46 
00075  129C  49 
00075  129D  4C 
00075  129E  45 
00076  129F  4E                 .BYTE $4E,$41,$4D,$45,$20,$20,$20,$20
00076  12A0  41 
00076  12A1  4D 
00076  12A2  45 
00076  12A3  20 
00076  12A4  20 
00076  12A5  20 
00076  12A6  20 
00077  12A7  20                 .BYTE $20,$20,$20,$20,$4C,$4F,$41,$44
00077  12A8  20 
00077  12A9  20 
00077  12AA  20 
00077  12AB  4C 
00077  12AC  4F 
00077  12AD  41 
00077  12AE  44 
00078  12AF  00                 .BYTE $00
00079  12B0              ;80 SYS(PEEK(43)+256*PEEK(44)+215)
00080  12B0  CB 04              .WORD $04CB
00081  12B2  50 00              .WORD $0050
00082  12B4  9E                 .BYTE $9E,$28,$C2,$28,$34,$33,$29,$AA
00082  12B5  28 
00082  12B6  C2 
00082  12B7  28 
00082  12B8  34 
00082  12B9  33 
00082  12BA  29 
00082  12BB  AA 
00083  12BC  32                 .BYTE $32,$35,$36,$AC,$C2,$28,$34,$34
00083  12BD  35 
00083  12BE  36 
00083  12BF  AC 
00083  12C0  C2 
00083  12C1  28 
00083  12C2  34 
00083  12C3  34 
00084  12C4  29                 .BYTE $29,$AA,$32,$31,$35,$29
00084  12C5  AA 
00084  12C6  32 
00084  12C7  31 






DOS 4.1 DISK WEDGE......PAGE 0006

LINE# LOC   CODE        LINE


00084  12C8  35 
00084  12C9  29 
00085  12CA  00                 .BYTE $00
00086  12CB              ;90 NEW
00087  12CB  D1 04              .WORD $04D1
00088  12CD  5A 00              .WORD $005A
00089  12CF  A2                 .BYTE $A2
00090  12D0  00                 .BYTE $00
00091  12D1              ;
00092  12D1  00 00              .WORD $0000
00093  12D3              ;*********************************
00094  12D3              ; CODE TO PROTECT WEDGE FROM BASIC
00095  12D3              ; BY ADJUSTING BASIC RAM TO AREA
00096  12D3              ; PAST WEDGE
00097  12D3              ;*********************************
00098  12D3              .LIB   MOVBASIC.ASM
00099  12D3              ; DOS4.1
00100  12D3              ;*********************************
00101  12D3              ;
00102  12D3              ;*********************************
00103  12D3              INDEX  = $0022
00104  12D3              INDEX2 = $0024
00105  12D3              VARTOP = $002B
00106  12D3              FRETOP = $0033
00107  12D3              MEMSIZ = $0037
00108  12D3              ;********************************
00109  12D3              ; CHARGET EQUATES
00110  12D3              ;********************************
00111  12D3              ZCHRGT = $0073
00112  12D3              ;********************************
00113  12D3              ;* = $0509 ; 3K EXPANSION
00114  12D3              ;* = $1109 ; NO EXPANSION
00115  12D3              ;********************************
00116  12D3              ; FILLER BYTES
00117  12D3              ;********************************
00118  12D3  AA                 .BYTE $AA,$AA,$AA,$AA,$AA
00118  12D4  AA 
00118  12D5  AA 
00118  12D6  AA 
00118  12D7  AA 
00119  12D8              ;********************************
00120  12D8              ;*=$050B ; 3K EXPANSION
00121  12D8              ;*=$110B ; NO EXPANSION
00122  12D8              ;********************************
00123  12D8              ; ADJUST BASIC MEMORY MAP TO
00124  12D8              ; PROTECT WEDGE AT ITS LOAD
00125  12D8              ; ADDRESS
00126  12D8              ;********************************
00127  12D8  A5 37       ZZ050B LDA MEMSIZ
00128  12DA  38                 SEC 
00129  12DB  E9 33              SBC #$33        ;'3'
00130  12DD  85 37              STA MEMSIZ
00131  12DF  85 33              STA FRETOP
00132  12E1  A5 38              LDA MEMSIZ+1
00133  12E3  E9 01              SBC #$01






DOS 4.1 DISK WEDGE......PAGE 0007

LINE# LOC   CODE        LINE


00134  12E5  85 38              STA MEMSIZ+1
00135  12E7  85 34              STA FRETOP+1
00136  12E9  A0 33              LDY #$33        ;'3'
00137  12EB  A5 2B              LDA VARTOP
00138  12ED  A6 2C              LDX VARTOP+1
00139  12EF  E8                 INX 
00140  12F0  E8                 INX 
00141  12F1  E8                 INX 
00142  12F2  85 22              STA INDEX
00143  12F4  86 23              STX INDEX+1
00144  12F6  A5 37              LDA MEMSIZ
00145  12F8  A6 38              LDX MEMSIZ+1
00146  12FA  E8                 INX 
00147  12FB  85 24              STA INDEX2
00148  12FD  86 25              STX INDEX2+1
00149  12FF  A2 01              LDX #$01
00150  1301  B1 22       XX0501 LDA (INDEX),Y
00151  1303  91 24              STA (INDEX2),Y
00152  1305  88                 DEY 
00153  1306  D0 F9              BNE XX0501
00154  1308  CA                 DEX 
00155  1309  F0 02              BEQ XX050D
00156  130B  30 0C              BMI XX0519
00157  130D  B1 22       XX050D LDA (INDEX),Y
00158  130F  91 24              STA (INDEX2),Y
00159  1311  C6 25              DEC INDEX2+1
00160  1313  C6 23              DEC INDEX+1
00161  1315  A0 00              LDY #$00
00162  1317  F0 E8              BEQ XX0501
00163  1319              ;********************************
00164  1319              ; PATCH CHRGET WITH JMP TO WEDGE
00165  1319              ;********************************
00166  1319  A9 4C       XX0519 LDA #$4C        ;'L'
00167  131B  85 73              STA ZCHRGT
00168  131D  A4 37              LDY MEMSIZ
00169  131F  A6 38              LDX MEMSIZ+1
00170  1321  C8                 INY 
00171  1322  D0 01              BNE XX0525
00172  1324  E8                 INX 
00173  1325  84 74       XX0525 STY ZCHRGT+1
00174  1327  86 75              STX ZCHRGT+2
00175  1329  60                 RTS 
00176  132A              ;********************************
00177  132A              ; FILLER BYTES (NOP) TO PAD MEMORY
00178  132A              ; FOR START OF WEDGE ON BOUNDARY
00179  132A              ;********************************
00180  132A              ZZ052A = * 
00181  132A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00181  132B  AA 
00181  132C  AA 
00181  132D  AA 
00181  132E  AA 
00181  132F  AA 
00181  1330  AA 
00181  1331  AA 






DOS 4.1 DISK WEDGE......PAGE 0008

LINE# LOC   CODE        LINE


00182  1332  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00182  1333  AA 
00182  1334  AA 
00182  1335  AA 
00182  1336  AA 
00182  1337  AA 
00182  1338  AA 
00182  1339  AA 
00183  133A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00183  133B  AA 
00183  133C  AA 
00183  133D  AA 
00183  133E  AA 
00183  133F  AA 
00183  1340  AA 
00183  1341  AA 
00184  1342  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00184  1343  AA 
00184  1344  AA 
00184  1345  AA 
00184  1346  AA 
00184  1347  AA 
00184  1348  AA 
00184  1349  AA 
00185  134A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00185  134B  AA 
00185  134C  AA 
00185  134D  AA 
00185  134E  AA 
00185  134F  AA 
00185  1350  AA 
00185  1351  AA 
00186  1352  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00186  1353  AA 
00186  1354  AA 
00186  1355  AA 
00186  1356  AA 
00186  1357  AA 
00186  1358  AA 
00186  1359  AA 
00187  135A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00187  135B  AA 
00187  135C  AA 
00187  135D  AA 
00187  135E  AA 
00187  135F  AA 
00187  1360  AA 
00187  1361  AA 
00188  1362  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00188  1363  AA 
00188  1364  AA 
00188  1365  AA 
00188  1366  AA 
00188  1367  AA 
00188  1368  AA 






DOS 4.1 DISK WEDGE......PAGE 0009

LINE# LOC   CODE        LINE


00188  1369  AA 
00189  136A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00189  136B  AA 
00189  136C  AA 
00189  136D  AA 
00189  136E  AA 
00189  136F  AA 
00189  1370  AA 
00189  1371  AA 
00190  1372  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00190  1373  AA 
00190  1374  AA 
00190  1375  AA 
00190  1376  AA 
00190  1377  AA 
00190  1378  AA 
00190  1379  AA 
00191  137A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00191  137B  AA 
00191  137C  AA 
00191  137D  AA 
00191  137E  AA 
00191  137F  AA 
00191  1380  AA 
00191  1381  AA 
00192  1382  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00192  1383  AA 
00192  1384  AA 
00192  1385  AA 
00192  1386  AA 
00192  1387  AA 
00192  1388  AA 
00192  1389  AA 
00193  138A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00193  138B  AA 
00193  138C  AA 
00193  138D  AA 
00193  138E  AA 
00193  138F  AA 
00193  1390  AA 
00193  1391  AA 
00194  1392  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00194  1393  AA 
00194  1394  AA 
00194  1395  AA 
00194  1396  AA 
00194  1397  AA 
00194  1398  AA 
00194  1399  AA 
00195  139A  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00195  139B  AA 
00195  139C  AA 
00195  139D  AA 
00195  139E  AA 
00195  139F  AA 






DOS 4.1 DISK WEDGE......PAGE 0010

LINE# LOC   CODE        LINE


00195  13A0  AA 
00195  13A1  AA 
00196  13A2  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00196  13A3  AA 
00196  13A4  AA 
00196  13A5  AA 
00196  13A6  AA 
00196  13A7  AA 
00196  13A8  AA 
00196  13A9  AA 
00197  13AA  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00197  13AB  AA 
00197  13AC  AA 
00197  13AD  AA 
00197  13AE  AA 
00197  13AF  AA 
00197  13B0  AA 
00197  13B1  AA 
00198  13B2  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00198  13B3  AA 
00198  13B4  AA 
00198  13B5  AA 
00198  13B6  AA 
00198  13B7  AA 
00198  13B8  AA 
00198  13B9  AA 
00199  13BA  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00199  13BB  AA 
00199  13BC  AA 
00199  13BD  AA 
00199  13BE  AA 
00199  13BF  AA 
00199  13C0  AA 
00199  13C1  AA 
00200  13C2  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00200  13C3  AA 
00200  13C4  AA 
00200  13C5  AA 
00200  13C6  AA 
00200  13C7  AA 
00200  13C8  AA 
00200  13C9  AA 
00201  13CA  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00201  13CB  AA 
00201  13CC  AA 
00201  13CD  AA 
00201  13CE  AA 
00201  13CF  AA 
00201  13D0  AA 
00201  13D1  AA 
00202  13D2  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00202  13D3  AA 
00202  13D4  AA 
00202  13D5  AA 
00202  13D6  AA 






DOS 4.1 DISK WEDGE......PAGE 0011

LINE# LOC   CODE        LINE


00202  13D7  AA 
00202  13D8  AA 
00202  13D9  AA 
00203  13DA  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00203  13DB  AA 
00203  13DC  AA 
00203  13DD  AA 
00203  13DE  AA 
00203  13DF  AA 
00203  13E0  AA 
00203  13E1  AA 
00204  13E2  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00204  13E3  AA 
00204  13E4  AA 
00204  13E5  AA 
00204  13E6  AA 
00204  13E7  AA 
00204  13E8  AA 
00204  13E9  AA 
00205  13EA  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00205  13EB  AA 
00205  13EC  AA 
00205  13ED  AA 
00205  13EE  AA 
00205  13EF  AA 
00205  13F0  AA 
00205  13F1  AA 
00206  13F2  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00206  13F3  AA 
00206  13F4  AA 
00206  13F5  AA 
00206  13F6  AA 
00206  13F7  AA 
00206  13F8  AA 
00206  13F9  AA 
00207  13FA  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA
00207  13FB  AA 
00207  13FC  AA 
00207  13FD  AA 
00207  13FE  AA 
00207  13FF  AA 
00207  1400  AA 
00208  1401  EA                 .BYTE $EA
00209  1402              ;********************************
00210  1402              ;
00211  1402              ;********************************
00212  1402              .END
00213  1402              ;*********************************
00214  1402              ; MAIN BODY OF CODE
00215  1402              ;*********************************
00216  1402              .FIL   DOS41.ASM
00217  1402              ;*********************************
00218  1402              ;
00219  1402              ;       DOS 4.1E DISK WEDGE
00220  1402              ;






DOS 4.1 DISK WEDGE......PAGE 0012

LINE# LOC   CODE        LINE


00221  1402              ;      VERSION V4.1/071382
00222  1402              ;      BY BOB FAIRBAIRN
00223  1402              ;        COPYRIGHT 1982
00224  1402              ;  COMMODORE BUSINESS MACHINES
00225  1402              ;
00226  1402              ;  DOCUMENTED BY DENTON MARLOWE
00227  1402              ;
00228  1402              ;********************************
00229  1402              ; EXTERNAL ADDRESS EQUATES
00230  1402              ;********************************
00231  1402              PRTLIN=$DDCD
00232  1402              CLOAD  =$E195
00233  1402              WARMBS=$E467
00234  1402              KCHROT=$E742
00235  1402              ;********************************
00236  1402              ; EXTERNAL ADDRESS EQUATES
00237  1402              ;********************************
00238  1402              SECOND = $FF93
00239  1402              TKSA   = $FF96
00240  1402              ACPTR  = $FFA5
00241  1402              CIOUT  = $FFA8
00242  1402              UNTLK  = $FFAB
00243  1402              UNLSN  = $FFAE
00244  1402              LISTEN = $FFB1
00245  1402              TALK   = $FFB4
00246  1402              SETLFS = $FFBA
00247  1402              SETNAM = $FFBD
00248  1402              OPEN   = $FFC0
00249  1402              CLOSE  = $FFC3
00250  1402              CLRCHN = $FFCC
00251  1402              CHROUT = $FFD2
00252  1402              LOAD   = $FFD5
00253  1402              STOP   = $FFE1
00254  1402              GETIN  = $FFE4
00255  1402              ;********************************
00256  1402              ; CHRGET EQUATES
00257  1402              ;********************************
00258  1402              RCHRGT = $79           ;JUMP BACK INTI CHRGET
00259  1402              TXTPTR = $7A           ;CHRGET POINTER
00260  1402              ;*********************************
00261  1402              ; DISK I/O ADDRESS
00262  1402              ;*********************************
00263  1402              STATUS = $90           ;KERNAL I/O STATUS
00264  1402              PRTY   = $9B           ;USED FOR TEMPORARY STORAG
E
00265  1402              ;*********************************
00266  1402              ;
00267  1402              ;*********************************
00268  1402              STACK  = $0100         ;6502 PROCESSOR STACK
00269  1402              ;*********************************
00270  1402              ; BASIC ROM ADDRESSES
00271  1402              ;*********************************
00272  1402              CHRGEC = $C48D         ;CALL TO CHRGET FROM DIREC
T MODE
00273  1402              ;********************************
00274  1402              ;
00275  1402              ;********************************






DOS 4.1 DISK WEDGE......PAGE 0013

LINE# LOC   CODE        LINE


00276  1402  E6 7A       WEDGE  INC TXTPTR
00277  1404  D0 02              BNE XX0608
00278  1406  E6 7B              INC TXTPTR+1
00279  1408  86 9B       XX0608 STX PRTY
00280  140A  BA                 TSX 
00281  140B              ;********************************
00282  140B              ; CHECK WHERE WE WERE CALLED FROM
00283  140B              ; $C48D - 1 CALL TO CHRGET FROM
00284  140B              ; $C483 BASIC WARM START
00285  140B              ;********************************
00286  140B  BD 01 01           LDA STACK+1,X
00287  140E  C9 8C              CMP #<CHRGEC-1  ;#$8C $C48C
00288  1410  D0 36              BNE XX0648
00289  1412  BD 02 01           LDA STACK+2,X
00290  1415  C9 C4              CMP #>CHRGEC    ;#$C4
00291  1417  D0 2F              BNE XX0648
00292  1419              ;********************************
00293  1419              ; CHECK COMMAND
00294  1419              ;********************************
00295  1419  A5 7A              LDA TXTPTR
00296  141B  D0 28              BNE XX0645      ;IF HIBYTE POINTER NON ZER
O EXIT
00297  141D              ;
00298  141D  A5 7B              LDA TXTPTR+1
00299  141F  C9 02              CMP #$02        ;DIRECT MODE
00300  1421  D0 22              BNE XX0645      ;NO EXIT
00301  1423              ;
00302  1423  A0 00              LDY #$00        ;SET INDEX=0
00303  1425  84 9B              STY PRTY        ;SAVE
00304  1427              ;********************************
00305  1427              ; CHECK COMMAND
00306  1427              ; @ OR > OR /
00307  1427              ;********************************
00308  1427  B1 7A              LDA (TXTPTR),Y
00309  1429  C9 3E              CMP #$3E        ;'>'
00310  142B  F0 0D              BEQ XX063A
00311  142D              ;
00312  142D  C9 40              CMP #$40        ;'@'
00313  142F  F0 09              BEQ XX063A
00314  1431              ;
00315  1431  C8                 INY 
00316  1432  85 9B              STA PRTY
00317  1434              ;
00318  1434  C9 2F              CMP #$2F        ;'/'
00319  1436  F0 55              BEQ XX068D
00320  1438              ;
00321  1438  D0 0B              BNE XX0645
00322  143A              ;********************************
00323  143A              ;
00324  143A              ;********************************
00325  143A  C8          XX063A INY 
00326  143B  B1 7A              LDA (TXTPTR),Y
00327  143D  F0 2C              BEQ XX066B
00328  143F              ;********************************
00329  143F              ; CHECK DIRECTORY COMMAND $
00330  143F              ;********************************






DOS 4.1 DISK WEDGE......PAGE 0014

LINE# LOC   CODE        LINE


00331  143F  C9 24              CMP #$24        ;'$'
00332  1441  F0 4A              BEQ XX068D
00333  1443              ;********************************
00334  1443              ; CHECK STATUS COMMAND ONLY
00335  1443              ;********************************
00336  1443  D0 08              BNE XX064D
00337  1445              ;********************************
00338  1445              ; NO COMMAND - PASS BACK TO PROCESSING LOOP
00339  1445              ;********************************
00340  1445  4C 79 00    XX0645 JMP RCHRGT
00341  1448              ;********************************
00342  1448              ; NOT OUR COMMAND 
00343  1448              ; RETURN TO CHRGET TO PROCESS COMMAND
00344  1448              ;********************************
00345  1448  A6 9B       XX0648 LDX PRTY        ; RECOVERY X REG
00346  144A  4C 79 00           JMP RCHRGT
00347  144D              ;********************************
00348  144D              ; @ OR / READ DRIVE STATUS
00349  144D              ;********************************
00350  144D  A9 08       XX064D LDA #$08
00351  144F  20 B1 FF           JSR LISTEN
00352  1452  A9 6F              LDA #$6F
00353  1454  20 93 FF           JSR SECOND
00354  1457              ;
00355  1457  E6 7A       XX0657 INC TXTPTR
00356  1459  A0 00              LDY #$00
00357  145B  B1 7A              LDA (TXTPTR),Y
00358  145D  F0 06              BEQ XX0665
00359  145F  20 A8 FF           JSR CIOUT
00360  1462  B8                 CLV 
00361  1463  50 F2              BVC XX0657
00362  1465  20 AE FF    XX0665 JSR UNLSN
00363  1468  B8                 CLV 
00364  1469  50 1F              BVC XX068A
00365  146B              ;
00366  146B  84 7A       XX066B STY TXTPTR
00367  146D  A9 08              LDA #$08
00368  146F  20 B4 FF           JSR TALK
00369  1472  A9 6F              LDA #$6F
00370  1474  20 96 FF           JSR TKSA
00371  1477              ;********************************
00372  1477              ; READ IN STATUS BYTES 00, OK,00,00
00373  1477              ;********************************
00374  1477  20 A5 FF    XX0677 JSR ACPTR
00375  147A  C9 0D              CMP #$0D
00376  147C  F0 06              BEQ XX0684
00377  147E  20 42 E7           JSR KCHROT
00378  1481  B8                 CLV 
00379  1482  50 F3              BVC XX0677
00380  1484  20 42 E7    XX0684 JSR KCHROT
00381  1487  20 AB FF           JSR UNTLK
00382  148A  4C 79 00    XX068A JMP RCHRGT
00383  148D              ;********************************
00384  148D              ; @$ OR /$ LIST DIRECTORY
00385  148D              ;********************************






DOS 4.1 DISK WEDGE......PAGE 0015

LINE# LOC   CODE        LINE


00386  148D  C8          XX068D INY 
00387  148E  B1 7A              LDA (TXTPTR),Y
00388  1490  D0 FB              BNE XX068D
00389  1492  88                 DEY 
00390  1493  98                 TYA 
00391  1494  A2 01              LDX #$01
00392  1496  A0 02              LDY #$02
00393  1498  20 BD FF           JSR SETNAM
00394  149B              ;********************************
00395  149B  A2 08              LDX #$08
00396  149D  A5 9B              LDA PRTY
00397  149F  D0 3E              BNE XX06DF
00398  14A1              ;
00399  14A1  A9 0E              LDA #$0E
00400  14A3  A0 60              LDY #$60
00401  14A5  20 BA FF           JSR SETLFS
00402  14A8              ;********************************
00403  14A8  20 C0 FF           JSR OPEN
00404  14AB              ;********************************
00405  14AB  A9 08              LDA #$08
00406  14AD  20 B4 FF           JSR TALK
00407  14B0  A9 60              LDA #$60
00408  14B2  20 96 FF           JSR TKSA
00409  14B5  A9 00              LDA #$00
00410  14B7  85 90              STA STATUS
00411  14B9  A0 03              LDY #$03
00412  14BB              ;********************************
00413  14BB  84 B7       RFILNM STY $B7
00414  14BD  20 A5 FF           JSR ACPTR
00415  14C0  85 B0              STA $B0
00416  14C2  A4 90              LDY STATUS
00417  14C4  D0 1B              BNE XX06E1
00418  14C6              ;********************************
00419  14C6  20 A5 FF           JSR ACPTR
00420  14C9  85 B1              STA $B1
00421  14CB  A4 90              LDY STATUS
00422  14CD  D0 12              BNE XX06E1
00423  14CF              ;********************************
00424  14CF  A4 B7              LDY $B7
00425  14D1  88                 DEY 
00426  14D2  D0 E7              BNE RFILNM
00427  14D4              ;********************************
00428  14D4  A6 B0              LDX $B0
00429  14D6  A5 B1              LDA $B1
00430  14D8  20 CD DD           JSR PRTLIN
00431  14DB  A9 20              LDA #$20        ;' '
00432  14DD  D0 06              BNE XX06E5
00433  14DF              ;********************************
00434  14DF  D0 40       XX06DF BNE LOADIT
00435  14E1              ;********************************
00436  14E1              ; DONE.
00437  14E1              ;********************************
00438  14E1  D0 31       XX06E1 BNE ENDER
00439  14E3              ;********************************
00440  14E3              ; LOOP BACK TO READ MORE CHARACTERS






DOS 4.1 DISK WEDGE......PAGE 0016

LINE# LOC   CODE        LINE


00441  14E3              ;********************************
00442  14E3  D0 D6       XX06E3 BNE RFILNM
00443  14E5              ;********************************
00444  14E5              ;
00445  14E5              ;********************************
00446  14E5  20 D2 FF    XX06E5 JSR CHROUT
00447  14E8  20 A5 FF    XX06E8 JSR ACPTR
00448  14EB  A6 90              LDX STATUS
00449  14ED  D0 25              BNE ENDER
00450  14EF              ;********************************
00451  14EF  C9 00              CMP #$00
00452  14F1  F0 18              BEQ XX070B
00453  14F3  20 D2 FF           JSR CHROUT
00454  14F6  20 E1 FF           JSR STOP
00455  14F9  F0 19              BEQ ENDER
00456  14FB              ;********************************
00457  14FB  20 E4 FF           JSR GETIN
00458  14FE  F0 E8              BEQ XX06E8
00459  1500  C9 20              CMP #$20        ;' '
00460  1502  D0 E4              BNE XX06E8
00461  1504  20 E4 FF    XX0704 JSR GETIN
00462  1507  F0 FB              BEQ XX0704
00463  1509  D0 DD              BNE XX06E8
00464  150B  A9 0D       XX070B LDA #$0D
00465  150D  20 D2 FF           JSR CHROUT
00466  1510  A0 02              LDY #$02
00467  1512  D0 CF              BNE XX06E3
00468  1514              ;********************************
00469  1514              ; DONE CLOSE CLEAR AND CLOSE CHANNEL
00470  1514              ;********************************
00471  1514  20 CC FF    ENDER  JSR CLRCHN      ;CLEAR I/O CHANNELS
00472  1517  A9 0E              LDA #$0E        ;DRIVE CHANNEL
00473  1519  20 C3 FF           JSR CLOSE       ;CLOSE
00474  151C  68                 PLA             ;PULL RTS ADDRESS
00475  151D  68                 PLA
00476  151E  4C 67 E4           JMP WARMBS
00477  1521              ;********************************
00478  1521              ; /FILENAME - LOAD FILENAME
00479  1521              ;********************************
00480  1521  A9 0E       LOADIT LDA #$0E
00481  1523  A0 00              LDY #$00
00482  1525  20 BA FF           JSR SETLFS
00483  1528  A9 00              LDA #$00
00484  152A  A6 2B              LDX VARTOP
00485  152C  A4 2C              LDY VARTOP+1
00486  152E  20 D5 FF           JSR LOAD
00487  1531              ;********************************
00488  1531              ; BASIC CLEANUP AFTER LOAD
00489  1531              ;********************************
00490  1531  4C 95 E1           JMP CLOAD
00491  1534              ;********************************
00492  1534              ;.END 
