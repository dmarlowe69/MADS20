KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
****************; STARTUP BANNER;********************************BANNER .BYTE $93 ; CLEAR SCREEN.BYTE $0D,$0D.BYTE '   VIC  DOS MANAGER',$0D.BYTE '    V4.1/071382',$0D,$0D.BYTE '  (C) 1982 COMMODORE',$0D.BYTE '   BUSINESS MACHINES',$0D,$00;*****KKKKKKKKK****************************BYE .BYTE 'BYE',$0D,$00;*********************************; DEVICE NUMBER;*********************************DEVICE .BYTE $AA;*********************************; LOAD/SAVE FLAG;*********************************LSFLAG .BYT ET ROM BYTE       STA ZCHRGT,X    ;PUT IN CHRGET       DEX             ;COUNT-1       BPL ROM         ;MOVE 3 BYTES;             LDX #BYE-BANNER       JSR STMSG;      JMP BASSFT      ;BACK TO BASIC;********************************.ENDKKKKKKKKE $AA;*********************************; DISABLE WEDGE (@Q);; REMOVE WEDGE FROM CHRGET BY; COPYING OVER THREE BYTE PATCH; WITH CORRECT BYTES FROM ROM;;*********************************QUITER LDX #$02        ;SET COUNTERROM    LDA CHRCPY,X    ;G
P #$24      ;'$'       BEQ XX068D;********************************; CHECK QUIT COMMAND Q;********************************       CMP #'Q'       BEQ QUIT;********************************; CHECK STATUS COMMAND ONLY;********************************TY TXTPTR       LDA #$08       JSR TALK       LDA #$6F       JSR TKSA;********************************; READ IN STATUS BYTES 00, OK,00,00;********************************XX0677 JSR ACPTR       CMP #$0D       BEQ XX0684       JSR KCHROT       SFLAG       ;********************************; @$ OR /$ LIST DIRECTORY;********************************XX068D INY        LDA (TXTPTR),Y       BNE XX068D       DEY        TYA        LDX #$01       LDY #$02       JSR SETNAM;********************JSR TKSA       LDA #$00       STA STATUS       LDY #$03;********************************RFILNM STY $B7       JSR ACPTR       STA $B0       LDY STATUS       BNE XX06E1;********************************       JSR ACPTR       STA $B1       LDY S********; LOAD/SAVE FILE;********************************XX06DF LDA LSFLAG       BNE SAVE1       JMP LOADIT;SAVE1  JMP SAVEIT;********************************; DONE.;********************************XX06E1 BNE ENDER;****************************************       CMP #$00       BEQ XX070B       JSR CHROUT       JSR STOP       BEQ ENDER;********************************       JSR GETIN       BEQ XX06E8       CMP #$20      ;' '       BNE XX06E8XX0704 JSR GETIN       BEQ XX0704              JSR CLOSE  ;CLOSE       PLA        ;PULL RTS ADDRESS       PLA       JMP WARMBS;********************************; /FILENAME - LOAD FILENAME;********************************LOADIT LDA #$0E       LDY #$00       JSR SETLFS       LDA #$00 E;; THE CURRENT PROGRAM IS THE BASIC; TEXT AREA IS SAVED DISK WITH; USER GIVEN FILENAME. THE FILE; WILL BE A PRG (PROGRAM) TYPE.; THE SAVE COMMAND HAS THE FORM:;; %FILENAME;; THE DRIVE STATUS IS RETURNED; FOLLOWING THE SAVE;;****************ANNEL (15),; INPUT BYTES FROM SERIAL BUS; AND PRINT THEM TO THE SCREEN; UNTILL A CARRIDGE RETURN IS; RECEIVED THEN UNTALK DEVICE;;*********************************ERROR LDA FA     ;GET DEVICE JSR TALK        ;TALK DEVICE LDA #$0F+$60    ;SEC+$60 TALK DEVICEEEXIT JMP RCHRGT ;RETURN;********************************; PRINT STARTUP BANNER;********************************PRMESS LDX #$00STMSG  LDA BANNER,X       BEQ DONE       JSR CHROUT       INX       BNE STMSGDONE   RTS;****************       BNE XX064D;********************************; NO COMMAND - PASS BACK TO PROCESSING LOOP;********************************XX0645 JMP RCHRGT;********************************; EXIT;********************************QUIT   JMP QUITER;***************XX064D LDA #$08       JSR LISTEN       LDA #$6F       JSR SECOND;XX0657 INC TXTPTR       LDY #$00       LDA (TXTPTR),Y       BEQ XX0665       JSR CIOUT       CLV        BVC XX0657;XX0665 JSR UNLSN       CLV        BVC XX068A;XX066B SCLV        BVC XX0677;XX0684 JSR KCHROT       JSR UNTLKXX068A JMP RCHRGT;********************************; @$ OR /$ LIST DIRECTORY;********************************LOADER LDA #$00       STA LSFLAG       BEQ XX068D;SAVER  LDA #$FF       STA L************       LDX #$08       LDA PRTY       BNE XX06DF;       LDA #$0E       LDY #$60       JSR SETLFS;********************************       JSR OPEN;********************************       LDA #$08       JSR TALK       LDA #$60       TATUS       BNE XX06E1;********************************       LDY $B7       DEY        BNE RFILNM;********************************       LDX $B0       LDA $B1       JSR PRTLIN       LDA #$20      ;' '       BNE XX06E5;*****************************; LOOP BACK TO READ MORE CHARACTERS;********************************XX06E3 BNE RFILNM;********************************;;********************************XX06E5 JSR CHROUTXX06E8 JSR ACPTR       LDX STATUS       BNE ENDER;*******************BNE XX06E8XX070B LDA #$0D       JSR CHROUT       LDY #$02       BNE XX06E3;********************************; DONE CLOSE CLEAR AND CLOSE CHANNEL;********************************ENDER  JSR CLRCHN ;CLEAR I/O CHANNELS       LDA #$0E   ;DRIVE CHANNEL      LDX VARTOP       LDY VARTOP+1       JSR LOAD;********************************; BASIC CLEANUP AFTER LOAD;********************************       JMP CLOAD;********************************; %FILENAME - SAVE FILENAME;; EXECUTE RELOCATABLE SAV****************SAVEIT JSR SAVET;       LDA #$0D       JMP ENDER;       JSR KCHROT     ;PRINT CHAR       JMP ERROR   ;DISPLAY STATUS;*********************************; READ DISK ERROR STATUS (@);; COMMAND DEVICE TO TALK, USING; THE COMMAND CH	 STA SA          ;PLACE SEC JSR TKSA        ;SEND SEC;ERR1 JSR ACPTR   ;GET BYTE CMP #$0D        ;IS IF CR? BEQ ERR2        ;IF SO DONE JSR KCHROT         ;PRINT CHAR JMP ERR1        ;NEXT BYTE;ERR2 JSR KCHROT     ;PRINT CR JSR UNTLK       ;UN********************; NOT OUR COMMAND ; RETURN TO CHRGET TO PROCESS COMMAND;********************************XX0648 LDX PRTY ; RECOVERY X REG       JMP RCHRGT;********************************; @ OR / READ DRIVE STATUS;*****************************
.PAGE 'DOS 4.1A DISK WEDGE'.OPT LIST;*********************************;* = $0401   ; 3K EXPANSION;* = $1001   ; NO EXPANSION;* = $1201    ; 32K EXPANSION* = $BC00   ; SYS 48128;*********************************;;       DOS 4.1A DISK WEDGE;;        VERSION V4.1A/071382;      BY BOB FAIRBAIRN;        COPYRIGHT 1982;  COMMODORE BUSINESS MACHINES;;  DOCUMENTED BY DENTON MARLOWE;;*********************************; INSTALL WEDGE INTO CHRGET LOOP;*********************************.LIB PATCHR /;********************************       LDA (TXTPTR),Y       CMP #$3E      ;'>'       BEQ XX063A;       CMP #$40      ;'@'       BEQ XX063A;       INY        STA PRTY;       CMP #$2F      ;'/'       BEQ LOADER;       CMP #'%'       BEQ***************************; PATCH CHRGET WITH JMP TO WEDGE;********************************XX0519 LDA #$4C      ;'L'       LDY #<WEDGE       LDX #>WEDGE;       STA ZCHRGT       STY ZCHRGT+1       STX ZCHRGT+2;       JSR START;       RTS ;*  SAVER;       BNE XX0645;********************************;;********************************XX063A INY        LDA (TXTPTR),Y       BEQ XX066B;********************************; CHECK DIRECTORY COMMAND $;********************************       CMADDRESS EQUATES;********************************PRTLIN=$DDCDCLOAD =$E195WARMBS=$E467KCHROT=$E742;********************************; KERNAL ROM EQUATES;********************************SAVET  = $E156 ;SAVE (PARAMS SET);**************************** $FFCCCHROUT = $FFD2LOAD   = $FFD5STOP   = $FFE1GETIN  = $FFE4;********************************; CHRGET EQUATES;********************************RCHRGT = $79 ;JUMP BACK INTI CHRGETTXTPTR = $7A ;CHRGET POINTER;*********************************; ;*********************************STACK  = $0100 ;6502 PROCESSOR STACK;*********************************; BASIC ROM ADDRESSES;*********************************BASSFT = $C480 ;RETURN TO BASICCHRGEC = $C48D ;CALL TO CHRGET FROM DIRECT MODECHRCPY = ***************************WEDGE  INC TXTPTR       BNE XX0608       INC TXTPTR+1XX0608 STX PRTY       TSX ;********************************; CHECK WHERE WE WERE CALLED FROM; $C48D - 1 CALL TO CHRGET FROM; $C483 BASIC WARM START;****************TR       BNE XX0645  ;IF HIBYTE POINTER NON ZERO EXIT;       LDA TXTPTR+1       CMP #$02    ;DIRECT MODE       BNE XX0645  ;NO EXIT;       LDY #$00   ;SET INDEX=0       STY PRTY   ;SAVE;********************************; CHECK COMMAND; @ OR > O   VERSION V4.1A/071382;      BY BOB FAIRBAIRN;        COPYRIGHT 1982;  COMMODORE BUSINESS MACHINES;;  DOCUMENTED BY DENTON MARLOWE;;*********************************; INSTALL WEDGE INTO CHRGET LOOP;*********************************.LIB PATCH.A.PAGE 'DOS 4.1A DISK WEDGE'.OPT NOLIST;*********************************;* = $0401   ; 3K EXPANSION;* = $1001   ; NO EXPANSION;* = $1201    ; 32K EXPANSION* = $BC00   ; SYS 48128;*********************************;;       DOS 4.1A DISK WEDGE;;  .ASM;*********************************; MAIN BODY OF CODE;*********************************.FIL DOS41A.ASM;*********************************.END       .BYTE $00;40 PRINT" @         OR COMMAND       .WORD $046C       .WORD $0028       .BYTE $99,;*********************************;;*********************************INDEX  = $0022INDEX2 = $0024VARTOP = $002BFRETOP = $0033MEMSIZ = $0037;********************************; CHARGET EQUATES;********************************ZCHRGT = $0073;***** I*******************************;;********************************.END = $FF93TKSA   = $FF96ACPTR  = $FFA5CIOUT  = $FFA8UNTLK  = $FFABUNLSN  = $FFAELISTEN = $FFB1TALK   = $FFB4SETLFS = $FFBASETNAM = $FFBDOPEN   = $FFC0CLOSE  = $FFC3CLRCHN =;*********************************;;       DOS 4.1E DISK WEDGE;;      VERSION V4.1/071382;      BY BOB FAIRBAIRN;        COPYRIGHT 1982;  COMMODORE BUSINESS MACHINES;;  DOCUMENTED BY DENTON MARLOWE;;********************************; EXTERNAL ****; EXTERNAL ADDRESS EQUATES;********************************SECOND = $FF93TKSA   = $FF96ACPTR  = $FFA5CIOUT  = $FFA8UNTLK  = $FFABUNLSN  = $FFAELISTEN = $FFB1TALK   = $FFB4SETLFS = $FFBASETNAM = $FFBDOPEN   = $FFC0CLOSE  = $FFC3CLRCHN =DISK I/O ADDRESS;*********************************STATUS = $90 ;KERNAL I/O STATUSPRTY   = $9B ;USED FOR TEMPORARY STORAGEFNLEN  = $B7 ;LENGTH OF FILENAMESA     = $B9 ;SECONDARY ADDRESSFA     = $BA ;DEVICE NUMBER;*********************************;$E387 ;ROM COPY OF CHRGET;********************************; INITIZATION;********************************START LDA FA       ;STORE CURRENT      STA DEVICE   ;DEVICE NUMBER;      JMP PRMESS   ;PRINT MESSAGE;********************************;;*****	****************       LDA STACK+1,X       CMP #<CHRGEC-1 ;#$8C $C48C       BNE XX0648       LDA STACK+2,X       CMP #>CHRGEC ;#$C4       BNE XX0648;********************************; CHECK COMMAND;********************************       LDA TXTP SM;*********************************; MAIN BODY OF CODE;*********************************.FIL DOS41A.ASM;*********************************.END0 PRINT" @$0;70 PRINT"{DOWN}/FILENAME    LOAD;80 SYS(PEEK(43)+256*PEEK(44)+215);90 NEW;***************A        VIC DOS 4.12ATEST             BCDOS41A.ASM            BCDOS41ANL.ASM            PATCH.ASM            DOS41A.ASM         %    BCDOS41A.OBJ            BCDOS41A            TESTS          KK  	TEST1                                                                                                                                                                                                                                          KKKKKKKKKKKKKK
;18BC00A94CA018A2BC8573847486752010BC60A5BA8D00BE4C9ABD0C63;18BC18E67AD002E67B869BBABD0101C98CD041BD0201C9C4D03AA50D7B;18BC307AD030A57BC902D02AA000849BB17AC93EF011C940F00DC80D23;18BC48859BC92FF060C925F063D00FC8B17AF033C924F05DC951F00EFE;18BC6005D00B459BD03EA90EA06020BAFF20C0FF0DB4;18BCD8A90820B4FFA9602096FFA9008590A00384B720A5FF85B0A40E27;18BCF090D02420A5FF85B1A490D01BA4B788D0E7A6B0A5B120CDDD1071;18BD08A920D00FAD01BED0034C57BD4C6ABDD031D0CD20D2FF20A50CEB;18BD20FFA690D025C900F01820D2FF20E1FFF0192D88;18BD987900A200BDA8BDF00620D2FFE8D0F560930D0D20202056490C4A;18BDB0432020444F53204D414E414745520D2020202056342E312F06AE;18BDC83037313338320D0D2020284329203139383220434F4D4D4F064F;18BDE0444F52450D202020425553494E455353204D414348494E4507CD;18BDF8530 Lstu ` Lz{A:z0{* z>@/`%cz3$]QLy LLy  o z z P Pz o   BP B Ly  z >`   `   $   BYE sS Lz{A:z0{* z>@/`%cz3$]QLy LLy  o z z P Pz o   BP B Ly  z >`   `   $  @
  BOOT DOS * A0A1:"DOS41",8,1 < A148128:                                                                                                                                                                                                   sS L`z{A:z0{* z>@/l%cz3$]QLy LLy  o z z P Pz o   BP B Ly  z >`   `   $   XX068D       DEY        TYA        LDX #$01       LDY #$02       JSR SETNAM;********************************       LDX #$08       LDA PRTY       BNE XX06DF;       LDA #$0E       LDY #$60       JSR SETLFS;********************************   @
  BOOT DOS * A0A1:"DOS41",8,1 < A148128:                                                                                                                                                                                                  ************; CHECK COMMAND; @ OR > OR /;********************************       LDA (TXTPTR),Y       CMP #$3E      ;'>'       BEQ XX063A;       CMP #$40      ;'@'       BEQ XX063A;       INY        STA PRTY;       CMP #$2F      ;'/'       C79004C02BEA69B4C7900A90820B1FFA96F2093FF0B36;18BC78E67AA000B17AF00620A8FFB850F220AEFFB8501F847AA9080DD1;18BC9020B4FFA96F2096FF20A5FFC90DF0062042E7B850F32042E70E21;18BCA820ABFF4C7900A9008D01BEF005A9FF8D01BEC8B17AD0FB880E2F;18BCC098A201A00220BDFFA208A0E4FFF0E8C9200FAE;18BD38D0E420E4FFF0FBD0DDA90D20D2FFA002D0CF20CCFFA90E201006;18BD50C3FF68684C67E4A90EA00020BAFFA900A62BA42C20D5FF4C0D08;18BD6895E12056E1A90D4C4ABD2042E74C78BDA5BA20B4FFA96F850DAC;18BD80B92096FF20A5FFC90DF0062042E74C84BD2042E720ABFF4C0 SD004259450D00AAAAA202BD87E39573CA10F8A253209C0BC4;04BE10BD4C80C4031F;0000170017D50C3FF68684C67E4A90EA00020BAFFA900A62BA42C20D5FF4C0D08;18BD6895E12056E1A90D4C4ABD2042E74C78BDA5BA20B4FFA96F850DAC;18BD80B92096FF20A5FFC90DF0062042E74C84BD2042E720ABFF4C0  LWLj1  %         hhLg   +, L VLJ BLx o   BL B Ly   `   VIC  DOS MANAGER    V4.1/071382  (C) 1982 COMMODORE   BUSINESS MACHINES /7E39573CA10F8A2532091BD4C80C40AB9;000016001690E20C3FF68684C67E4A90EA0000D81;18BD5020BAFFA900A62BA42C20D5FF4C95E12056E1A90D4C3FBD200C73;18BD6842E74C6DBDA5BA20B4FFA96F85B92096FF20A5FFC90DF0060EA9;18BD802042E74C79BD2042E720ABFF4C7900A200BD9DBDF00620D20 LLL_1  %         hhLg   +, L VL? BLm o   BLy B Ly   `   VIC  DOS MANAGER    V4.1/071382  (C) 1982 COMMODORE   BUSINESS MACHINES BYE 	***********************       LDA TXTPTR       BNE XX0645  ;IF HIBYTE POINTER NON ZERO EXIT;       LDA TXTPTR+1       CMP #$02    ;DIRECT MODE       BNE XX0645  ;NO EXIT;       LDY #$00   ;SET INDEX=0       STY PRTY   ;SAVE;********************     JSR OPEN;********************************       LDA #$08       JSR TALK       LDA #$60       JSR TKSA       LDA #$00       STA STATUS       LDY #$03;********************************RFILNM STY $B7       JSR ACPTR       STA $B0       LDY  STATUS       BNE XX06E1;********************************       JSR ACPTR       STA $B1       LDY STATUS       BNE XX06E1;********************************       LDY $B7       DEY        BNE RFILNM;********************************       LDX $B0
       LDA $B1       JSR PRTLIN       LDA #$20      ;' '       BNE XX06E5;********************************XX06DF BNE LOADIT;********************************; DONE.;********************************XX06E1 BNE ENDER;******************************K**********       CMP #$00       BEQ XX070B       JSR CHROUT       JSR STOP       BEQ ENDER;********************************       JSR GETIN       BEQ XX06E8       CMP #$20      ;' '       BNE XX06E8XX0704 JSR GETIN       BEQ XX0704       BNEK     JSR CLOSE  ;CLOSE       PLA        ;PULL RTS ADDRESS       PLA       JMP WARMBS;********************************; /FILENAME - LOAD FILENAME;********************************LOADIT LDA #$0E       LDY #$00       JSR SETLFS       LDA #$00    KKKKK**; LOOP BACK TO READ MORE CHARACTERS;********************************XX06E3 BNE RFILNM;********************************;;********************************XX06E5 JSR CHROUTXX06E8 JSR ACPTR       LDX STATUS       BNE ENDER;**********************K XX06E8XX070B LDA #$0D       JSR CHROUT       LDY #$02       BNE XX06E3;********************************; DONE CLOSE CLEAR AND CLOSE CHANNEL;********************************ENDER  JSR CLRCHN ;CLEAR I/O CHANNELS       LDA #$0E   ;DRIVE CHANNEL  K    LDX VARTOP       LDY VARTOP+1       JSR LOAD;********************************; BASIC CLEANUP AFTER LOAD;********************************       JMP CLOAD;********************************;.END KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK