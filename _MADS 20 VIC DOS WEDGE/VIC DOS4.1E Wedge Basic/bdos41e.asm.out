BDOS41E.ASM......PAGE 0001

LINE# LOC   CODE        LINE































































DOS 4.1E DISK WEDGE......PAGE 0002

LINE# LOC   CODE        LINE


00003  0000              ;*********************************
00004  0000              ;* = $0401   ; 3K EXPANSION
00005  0000              ;* = $1001   ; NO EXPANSION
00006  0000              *      = $1201         ; 32K EXPANSION
00007  1201              ;* = $BC00   ; SYS 48128
00008  1201              ;*********************************
00009  1201              ;
00010  1201              ;       DOS 4.1E DISK WEDGE
00011  1201              ;
00012  1201              ;      VERSION V4.1/071382
00013  1201              ;      BY BOB FAIRBAIRN
00014  1201              ;        COPYRIGHT 1982
00015  1201              ;  COMMODORE BUSINESS MACHINES
00016  1201              ;
00017  1201              ;  DOCUMENTED BY DENTON MARLOWE
00018  1201              ;
00019  1201              ;*********************************
00020  1201              ; BASIC STUB
00021  1201              ;*********************************
00022  1201              ;1 PRINT".CLEAR..DOWN.      VIC WEDGE"
00023  1201              ;2 PRINT".DOWN.   BY DAVID A. HOOK"
00024  1201              ;3 PRINT".DOWN. >        DISK STATUS"
00025  1201              ;4 PRINT" @         OR COMMAND"
00026  1201              ;5 PRINT".DOWN. >$       DIRECTORY":PRINT" @$" 
00027  1201              ;6 PRINT".DOWN. /FILE    LOAD" 
00028  1201              ;7 INPUT".DOWN..DOWN.DEVICE  8.LEFT..LEFT..LEFT."
;D 
00029  1201              ;8 A=PEEK(43)+256*PEEK(44):POKEA+589,D:POKEA+621,
D:POKEA+667,D:POKEA+683,D 
00030  1201              ;9 SYSA+266:NEW 
00031  1201              ;********************************
00032  1201              ;1 PRINT".CLEAR..DOWN.      VIC WEDGE"
00033  1201  19 04              .WORD $0419
00034  1203  01 00              .WORD $0001
00035  1205  99                 .BYTE $99,$22,$93,$11,$20,$20,$20,$20,$20,
$20
00035  1206  22 
00035  1207  93 
00035  1208  11 
00035  1209  20 
00035  120A  20 
00035  120B  20 
00035  120C  20 
00035  120D  20 
00035  120E  20 
00036  120F  56                 .BYTE $56,$49,$43,$20,$57,$45,$44,$47,$45
00036  1210  49 
00036  1211  43 
00036  1212  20 
00036  1213  57 
00036  1214  45 
00036  1215  44 
00036  1216  47 
00036  1217  45 
00037  1218  00                 .BYTE $00
00038  1219              ;2 PRINT".DOWN.   BY DAVID A. HOOK"
00039  1219  34 04              .WORD $0434
00040  121B  02 00              .WORD $0002






DOS 4.1E DISK WEDGE......PAGE 0003

LINE# LOC   CODE        LINE


00041  121D  99                 .BYTE $99,$22,$11,$20,$20,$20,$42,$59,$20
00041  121E  22 
00041  121F  11 
00041  1220  20 
00041  1221  20 
00041  1222  20 
00041  1223  42 
00041  1224  59 
00041  1225  20 
00042  1226  44                 .BYTE $44,$41,$56,$49,$44,$20,$41,$2E,$20
00042  1227  41 
00042  1228  56 
00042  1229  49 
00042  122A  44 
00042  122B  20 
00042  122C  41 
00042  122D  2E 
00042  122E  20 
00043  122F  48                 .BYTE $48,$4F,$4F,$4B
00043  1230  4F 
00043  1231  4F 
00043  1232  4B 
00044  1233  00                 .BYTE $00
00045  1234              ;3 PRINT".DOWN. >        DISK STATUS"
00046  1234  51 04              .WORD $0451
00047  1236  03 00              .WORD $0003
00048  1238  99                 .BYTE $99,$22,$11,$20,$3E,$20,$20,$20,$20
00048  1239  22 
00048  123A  11 
00048  123B  20 
00048  123C  3E 
00048  123D  20 
00048  123E  20 
00048  123F  20 
00048  1240  20 
00049  1241  20                 .BYTE $20,$20,$20,$20,$44,$49,$53,$4B,$20
00049  1242  20 
00049  1243  20 
00049  1244  20 
00049  1245  44 
00049  1246  49 
00049  1247  53 
00049  1248  4B 
00049  1249  20 
00050  124A  53                 .BYTE $53,$54,$41,$54,$55,$53
00050  124B  54 
00050  124C  41 
00050  124D  54 
00050  124E  55 
00050  124F  53 
00051  1250  00                 .BYTE $00
00052  1251              ;4 PRINT" @         OR COMMAND"
00053  1251  6D 04              .WORD $046D
00054  1253  04 00              .WORD $0004
00055  1255  99                 .BYTE $99,$22,$20,$40,$20,$20,$20,$20,$20,
$20






DOS 4.1E DISK WEDGE......PAGE 0004

LINE# LOC   CODE        LINE


00055  1256  22 
00055  1257  20 
00055  1258  40 
00055  1259  20 
00055  125A  20 
00055  125B  20 
00055  125C  20 
00055  125D  20 
00055  125E  20 
00056  125F  20                 .BYTE $20,$20,$20,$4F,$52,$20,$43,$4F,$4D,
$4D
00056  1260  20 
00056  1261  20 
00056  1262  4F 
00056  1263  52 
00056  1264  20 
00056  1265  43 
00056  1266  4F 
00056  1267  4D 
00056  1268  4D 
00057  1269  41                 .BYTE $41,$4E,$44
00057  126A  4E 
00057  126B  44 
00058  126C  00                 .BYTE $00
00059  126D              ;5 PRINT".DOWN. >$       DIRECTORY":PRINT" @$" 
00060  126D  8F 04              .WORD $048F
00061  126F  05 00              .WORD $0005
00062  1271  99                 .BYTE $99,$22,$11,$20,$3E,$24,$20,$20,$20,
$20
00062  1272  22 
00062  1273  11 
00062  1274  20 
00062  1275  3E 
00062  1276  24 
00062  1277  20 
00062  1278  20 
00062  1279  20 
00062  127A  20 
00063  127B  20                 .BYTE $20,$20,$20,$44,$49,$52,$45,$43,$54,
$4F
00063  127C  20 
00063  127D  20 
00063  127E  44 
00063  127F  49 
00063  1280  52 
00063  1281  45 
00063  1282  43 
00063  1283  54 
00063  1284  4F 
00064  1285  52                 .BYTE $52,$59,$22,$3A,$99,$22,$20,$40,$24
00064  1286  59 
00064  1287  22 
00064  1288  3A 
00064  1289  99 
00064  128A  22 
00064  128B  20 
00064  128C  40 
00064  128D  24 






DOS 4.1E DISK WEDGE......PAGE 0005

LINE# LOC   CODE        LINE


00065  128E  00                 .BYTE $00
00066  128F              ;6 PRINT".DOWN. /FILE    LOAD" 
00067  128F  A5 04              .WORD $04A5
00068  1291  06 00              .WORD $0006
00069  1293  99                 .BYTE $99,$22,$11,$20,$2F,$46,$49,$4C,$45,
$20
00069  1294  22 
00069  1295  11 
00069  1296  20 
00069  1297  2F 
00069  1298  46 
00069  1299  49 
00069  129A  4C 
00069  129B  45 
00069  129C  20 
00070  129D  20                 .BYTE $20,$20,$20,$4C,$4F,$41,$44
00070  129E  20 
00070  129F  20 
00070  12A0  4C 
00070  12A1  4F 
00070  12A2  41 
00070  12A3  44 
00071  12A4  00                 .BYTE $00
00072  12A5              ;7 INPUT".DOWN..DOWN.DEVICE  8.LEFT..LEFT..LEFT."
;D 
00073  12A5  BD 04              .WORD $04BD
00074  12A7  07 00              .WORD $0007
00075  12A9  85                 .BYTE $85,$22,$11,$11,$44,$45,$56,$49,$43,
$45
00075  12AA  22 
00075  12AB  11 
00075  12AC  11 
00075  12AD  44 
00075  12AE  45 
00075  12AF  56 
00075  12B0  49 
00075  12B1  43 
00075  12B2  45 
00076  12B3  20                 .BYTE $20,$20,$38,$9D,$9D,$9D,$22,$3B,$44
00076  12B4  20 
00076  12B5  38 
00076  12B6  9D 
00076  12B7  9D 
00076  12B8  9D 
00076  12B9  22 
00076  12BA  3B 
00076  12BB  44 
00077  12BC  00                 .BYTE $00
00078  12BD              ;8 A=PEEK(43)+256*PEEK(44):POKEA+589,D:POKEA+621,
D:POKEA+667,D:POKEA+683,D 
00079  12BD  F7 04              .WORD $04F7
00080  12BF  08 00              .WORD $0008
00081  12C1  41                 .BYTE $41,$B2,$C2,$28,$34,$33,$29,$AA,$32,
$35
00081  12C2  B2 
00081  12C3  C2 
00081  12C4  28 
00081  12C5  34 
00081  12C6  33 
00081  12C7  29 






DOS 4.1E DISK WEDGE......PAGE 0006

LINE# LOC   CODE        LINE


00081  12C8  AA 
00081  12C9  32 
00081  12CA  35 
00082  12CB  36                 .BYTE $36,$AC,$C2,$28,$34,$34,$29,$3A,$97,
$41
00082  12CC  AC 
00082  12CD  C2 
00082  12CE  28 
00082  12CF  34 
00082  12D0  34 
00082  12D1  29 
00082  12D2  3A 
00082  12D3  97 
00082  12D4  41 
00083  12D5  AA                 .BYTE $AA,$35,$38,$39,$2C,$44,$3A,$97,$41,
$AA
00083  12D6  35 
00083  12D7  38 
00083  12D8  39 
00083  12D9  2C 
00083  12DA  44 
00083  12DB  3A 
00083  12DC  97 
00083  12DD  41 
00083  12DE  AA 
00084  12DF  36                 .BYTE $36,$32,$31,$2C,$44,$3A,$97,$41,$AA,
$36
00084  12E0  32 
00084  12E1  31 
00084  12E2  2C 
00084  12E3  44 
00084  12E4  3A 
00084  12E5  97 
00084  12E6  41 
00084  12E7  AA 
00084  12E8  36 
00085  12E9  36                 .BYTE $36,$37,$2C,$44,$3A,$97,$41,$AA,$36,
$38
00085  12EA  37 
00085  12EB  2C 
00085  12EC  44 
00085  12ED  3A 
00085  12EE  97 
00085  12EF  41 
00085  12F0  AA 
00085  12F1  36 
00085  12F2  38 
00086  12F3  33                 .BYTE $33,$2C,$44
00086  12F4  2C 
00086  12F5  44 
00087  12F6  00                 .BYTE $00
00088  12F7              ;9 SYSA+266:NEW 
00089  12F7  04 05              .WORD $0504
00090  12F9  09 00              .WORD $0009
00091  12FB  9E                 .BYTE $9E,$41,$AA,$32,$36,$36,$3A,$A2
00091  12FC  41 
00091  12FD  AA 
00091  12FE  32 
00091  12FF  36 






DOS 4.1E DISK WEDGE......PAGE 0007

LINE# LOC   CODE        LINE


00091  1300  36 
00091  1301  3A 
00091  1302  A2 
00092  1303  00                 .BYTE $00
00093  1304  00 00              .WORD $0000
00094  1306              ;*********************************
00095  1306              ; CODE TO PROTECT WEDGE FROM BASIC
00096  1306              ; BY ADJUSTING BASIC RAM TO AREA
00097  1306              ; PAST WEDGE
00098  1306              ;*********************************
00099  1306              .LIB   MOVBASICE.ASM
00100  1306              ; DOS41.E
00101  1306              ;*********************************
00102  1306              ;
00103  1306              ;*********************************
00104  1306              INDEX  = $0022
00105  1306              INDEX2 = $0024
00106  1306              VARTOP = $002B
00107  1306              FRETOP = $0033
00108  1306              MEMSIZ = $0037
00109  1306              ;********************************
00110  1306              ; CHARGET EQUATES
00111  1306              ;********************************
00112  1306              ZCHRGT = $0073
00113  1306              ;********************************
00114  1306              ;* = $0509 ; 3K EXPANSION
00115  1306              ;* = $1109 ; NO EXPANSION
00116  1306              ;********************************
00117  1306              ; FILLER BYTES
00118  1306              ;********************************
00119  1306  EA          FILLER .BYTE $EA,$EA,$EA,$EA,$EA
00119  1307  EA 
00119  1308  EA 
00119  1309  EA 
00119  130A  EA 
00120  130B              ;********************************
00121  130B              ;*=$050B ; 3K EXPANSION
00122  130B              ;*=$110B ; NO EXPANSION
00123  130B              ;********************************
00124  130B              ; ADJUST BASIC MEMORY MAP TO
00125  130B              ; PROTECT WEDGE AT ITS LOAD
00126  130B              ; ADDRESS
00127  130B              ;********************************
00128  130B  A5 37       ZZ050B LDA MEMSIZ
00129  130D  38                 SEC 
00130  130E  E9 33              SBC #$33        ;'3'
00131  1310  85 37              STA MEMSIZ
00132  1312  85 33              STA FRETOP
00133  1314  A5 38              LDA MEMSIZ+1
00134  1316  E9 01              SBC #$01
00135  1318  85 38              STA MEMSIZ+1
00136  131A  85 34              STA FRETOP+1
00137  131C  A0 33              LDY #$33        ;'3'
00138  131E  A5 2B              LDA VARTOP
00139  1320  A6 2C              LDX VARTOP+1






DOS 4.1E DISK WEDGE......PAGE 0008

LINE# LOC   CODE        LINE


00140  1322  E8                 INX 
00141  1323  E8                 INX 
00142  1324  E8                 INX 
00143  1325  85 22              STA INDEX
00144  1327  86 23              STX INDEX+1
00145  1329  A5 37              LDA MEMSIZ
00146  132B  A6 38              LDX MEMSIZ+1
00147  132D  E8                 INX 
00148  132E  85 24              STA INDEX2
00149  1330  86 25              STX INDEX2+1
00150  1332  A2 01              LDX #$01
00151  1334  B1 22       XX0534 LDA (INDEX),Y
00152  1336  91 24              STA (INDEX2),Y
00153  1338  88                 DEY 
00154  1339  D0 F9              BNE XX0534
00155  133B  CA                 DEX 
00156  133C  F0 02              BEQ XX0540
00157  133E  30 0C              BMI XX054C
00158  1340  B1 22       XX0540 LDA (INDEX),Y
00159  1342  91 24              STA (INDEX2),Y
00160  1344  C6 25              DEC INDEX2+1
00161  1346  C6 23              DEC INDEX+1
00162  1348  A0 00              LDY #$00
00163  134A  F0 E8              BEQ XX0534
00164  134C              ;********************************
00165  134C              ; PATCH CHRGET WITH JMP TO WEDGE
00166  134C              ;********************************
00167  134C  A9 4C       XX054C LDA #$4C        ; OPCODE FOR JMP
00168  134E  85 73              STA ZCHRGT
00169  1350  A4 37              LDY MEMSIZ
00170  1352  A6 38              LDX MEMSIZ+1
00171  1354  C8                 INY 
00172  1355  D0 01              BNE XX0558
00173  1357  E8                 INX 
00174  1358  84 74       XX0558 STY ZCHRGT+1
00175  135A  86 75              STX ZCHRGT+2
00176  135C  60                 RTS
00177  135D              ;********************************
00178  135D              ; FILLER BYTES (NOP) TO PAD MEMORY
00179  135D              ; FOR START OF WEDGE ON BOUNDARY
00180  135D              ;********************************
00181  135D              ZZ055D = * 
00182  135D  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00182  135E  EA 
00182  135F  EA 
00182  1360  EA 
00182  1361  EA 
00182  1362  EA 
00182  1363  EA 
00182  1364  EA 
00182  1365  EA 
00182  1366  EA 
00182  1367  EA 
00182  1368  EA 
00182  1369  EA 






DOS 4.1E DISK WEDGE......PAGE 0009

LINE# LOC   CODE        LINE


00182  136A  EA 
00182  136B  EA 
00182  136C  EA 
00183  136D  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00183  136E  EA 
00183  136F  EA 
00183  1370  EA 
00183  1371  EA 
00183  1372  EA 
00183  1373  EA 
00183  1374  EA 
00183  1375  EA 
00183  1376  EA 
00183  1377  EA 
00183  1378  EA 
00183  1379  EA 
00183  137A  EA 
00183  137B  EA 
00183  137C  EA 
00184  137D  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00184  137E  EA 
00184  137F  EA 
00184  1380  EA 
00184  1381  EA 
00184  1382  EA 
00184  1383  EA 
00184  1384  EA 
00184  1385  EA 
00184  1386  EA 
00184  1387  EA 
00184  1388  EA 
00184  1389  EA 
00184  138A  EA 
00184  138B  EA 
00184  138C  EA 
00185  138D  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00185  138E  EA 
00185  138F  EA 
00185  1390  EA 
00185  1391  EA 
00185  1392  EA 
00185  1393  EA 
00185  1394  EA 
00185  1395  EA 
00185  1396  EA 
00185  1397  EA 
00185  1398  EA 
00185  1399  EA 
00185  139A  EA 
00185  139B  EA 
00185  139C  EA 
00186  139D  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00186  139E  EA 
00186  139F  EA 
00186  13A0  EA 






DOS 4.1E DISK WEDGE......PAGE 0010

LINE# LOC   CODE        LINE


00186  13A1  EA 
00186  13A2  EA 
00186  13A3  EA 
00186  13A4  EA 
00186  13A5  EA 
00186  13A6  EA 
00186  13A7  EA 
00186  13A8  EA 
00186  13A9  EA 
00186  13AA  EA 
00186  13AB  EA 
00186  13AC  EA 
00187  13AD  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00187  13AE  EA 
00187  13AF  EA 
00187  13B0  EA 
00187  13B1  EA 
00187  13B2  EA 
00187  13B3  EA 
00187  13B4  EA 
00187  13B5  EA 
00187  13B6  EA 
00187  13B7  EA 
00187  13B8  EA 
00187  13B9  EA 
00187  13BA  EA 
00187  13BB  EA 
00187  13BC  EA 
00188  13BD  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00188  13BE  EA 
00188  13BF  EA 
00188  13C0  EA 
00188  13C1  EA 
00188  13C2  EA 
00188  13C3  EA 
00188  13C4  EA 
00188  13C5  EA 
00188  13C6  EA 
00188  13C7  EA 
00188  13C8  EA 
00188  13C9  EA 
00188  13CA  EA 
00188  13CB  EA 
00188  13CC  EA 
00189  13CD  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00189  13CE  EA 
00189  13CF  EA 
00189  13D0  EA 
00189  13D1  EA 
00189  13D2  EA 
00189  13D3  EA 
00189  13D4  EA 
00189  13D5  EA 
00189  13D6  EA 
00189  13D7  EA 






DOS 4.1E DISK WEDGE......PAGE 0011

LINE# LOC   CODE        LINE


00189  13D8  EA 
00189  13D9  EA 
00189  13DA  EA 
00189  13DB  EA 
00189  13DC  EA 
00190  13DD  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00190  13DE  EA 
00190  13DF  EA 
00190  13E0  EA 
00190  13E1  EA 
00190  13E2  EA 
00190  13E3  EA 
00190  13E4  EA 
00190  13E5  EA 
00190  13E6  EA 
00190  13E7  EA 
00190  13E8  EA 
00190  13E9  EA 
00190  13EA  EA 
00190  13EB  EA 
00190  13EC  EA 
00191  13ED  EA                 .BYTE $EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,$EA,
$EA,$EA,$EA,$EA,$EA,$EA,$EA
00191  13EE  EA 
00191  13EF  EA 
00191  13F0  EA 
00191  13F1  EA 
00191  13F2  EA 
00191  13F3  EA 
00191  13F4  EA 
00191  13F5  EA 
00191  13F6  EA 
00191  13F7  EA 
00191  13F8  EA 
00191  13F9  EA 
00191  13FA  EA 
00191  13FB  EA 
00191  13FC  EA 
00192  13FD  EA                 .BYTE $EA,$EA,$EA,$EA,$EA
00192  13FE  EA 
00192  13FF  EA 
00192  1400  EA 
00192  1401  EA 
00193  1402                                     ;*************************
*******
00194  1402              ; 
00195  1402              ;********************************
00196  1402              .END
00197  1402              ;*********************************
00198  1402              ; MAIN BODY OF CODE
00199  1402              ;*********************************
00200  1402              .FIL   DOS41.ASM
00201  1402              ;*********************************
00202  1402              ;
00203  1402              ;       DOS 4.1E DISK WEDGE
00204  1402              ;
00205  1402              ;      VERSION V4.1/071382






DOS 4.1E DISK WEDGE......PAGE 0012

LINE# LOC   CODE        LINE


00206  1402              ;      BY BOB FAIRBAIRN
00207  1402              ;        COPYRIGHT 1982
00208  1402              ;  COMMODORE BUSINESS MACHINES
00209  1402              ;
00210  1402              ;  DOCUMENTED BY DENTON MARLOWE
00211  1402              ;
00212  1402              ;********************************
00213  1402              ; EXTERNAL ADDRESS EQUATES
00214  1402              ;********************************
00215  1402              PRTLIN=$DDCD
00216  1402              CLOAD  =$E195
00217  1402              WARMBS=$E467
00218  1402              KCHROT=$E742
00219  1402              ;********************************
00220  1402              ; EXTERNAL ADDRESS EQUATES
00221  1402              ;********************************
00222  1402              SECOND = $FF93
00223  1402              TKSA   = $FF96
00224  1402              ACPTR  = $FFA5
00225  1402              CIOUT  = $FFA8
00226  1402              UNTLK  = $FFAB
00227  1402              UNLSN  = $FFAE
00228  1402              LISTEN = $FFB1
00229  1402              TALK   = $FFB4
00230  1402              SETLFS = $FFBA
00231  1402              SETNAM = $FFBD
00232  1402              OPEN   = $FFC0
00233  1402              CLOSE  = $FFC3
00234  1402              CLRCHN = $FFCC
00235  1402              CHROUT = $FFD2
00236  1402              LOAD   = $FFD5
00237  1402              STOP   = $FFE1
00238  1402              GETIN  = $FFE4
00239  1402              ;********************************
00240  1402              ; CHRGET EQUATES
00241  1402              ;********************************
00242  1402              RCHRGT = $79           ;JUMP BACK INTI CHRGET
00243  1402              TXTPTR = $7A           ;CHRGET POINTER
00244  1402              ;*********************************
00245  1402              ; DISK I/O ADDRESS
00246  1402              ;*********************************
00247  1402              STATUS = $90           ;KERNAL I/O STATUS
00248  1402              PRTY   = $9B           ;USED FOR TEMPORARY STORAG
E
00249  1402              ;*********************************
00250  1402              ;
00251  1402              ;*********************************
00252  1402              STACK  = $0100         ;6502 PROCESSOR STACK
00253  1402              ;*********************************
00254  1402              ; BASIC ROM ADDRESSES
00255  1402              ;*********************************
00256  1402              CHRGEC = $C48D         ;CALL TO CHRGET FROM DIREC
T MODE
00257  1402              ;********************************
00258  1402              ;
00259  1402              ;********************************
00260  1402  E6 7A       WEDGE  INC TXTPTR






DOS 4.1E DISK WEDGE......PAGE 0013

LINE# LOC   CODE        LINE


00261  1404  D0 02              BNE XX0608
00262  1406  E6 7B              INC TXTPTR+1
00263  1408  86 9B       XX0608 STX PRTY
00264  140A  BA                 TSX 
00265  140B              ;********************************
00266  140B              ; CHECK WHERE WE WERE CALLED FROM
00267  140B              ; $C48D - 1 CALL TO CHRGET FROM
00268  140B              ; $C483 BASIC WARM START
00269  140B              ;********************************
00270  140B  BD 01 01           LDA STACK+1,X
00271  140E  C9 8C              CMP #<CHRGEC-1  ;#$8C $C48C
00272  1410  D0 36              BNE XX0648
00273  1412  BD 02 01           LDA STACK+2,X
00274  1415  C9 C4              CMP #>CHRGEC    ;#$C4
00275  1417  D0 2F              BNE XX0648
00276  1419              ;********************************
00277  1419              ; CHECK COMMAND
00278  1419              ;********************************
00279  1419  A5 7A              LDA TXTPTR
00280  141B  D0 28              BNE XX0645      ;IF HIBYTE POINTER NON ZER
O EXIT
00281  141D              ;
00282  141D  A5 7B              LDA TXTPTR+1
00283  141F  C9 02              CMP #$02        ;DIRECT MODE
00284  1421  D0 22              BNE XX0645      ;NO EXIT
00285  1423              ;
00286  1423  A0 00              LDY #$00        ;SET INDEX=0
00287  1425  84 9B              STY PRTY        ;SAVE
00288  1427              ;********************************
00289  1427              ; CHECK COMMAND
00290  1427              ; @ OR > OR /
00291  1427              ;********************************
00292  1427  B1 7A              LDA (TXTPTR),Y
00293  1429  C9 3E              CMP #$3E        ;'>'
00294  142B  F0 0D              BEQ XX063A
00295  142D              ;
00296  142D  C9 40              CMP #$40        ;'@'
00297  142F  F0 09              BEQ XX063A
00298  1431              ;
00299  1431  C8                 INY 
00300  1432  85 9B              STA PRTY
00301  1434              ;
00302  1434  C9 2F              CMP #$2F        ;'/'
00303  1436  F0 55              BEQ XX068D
00304  1438              ;
00305  1438  D0 0B              BNE XX0645
00306  143A              ;********************************
00307  143A              ;
00308  143A              ;********************************
00309  143A  C8          XX063A INY 
00310  143B  B1 7A              LDA (TXTPTR),Y
00311  143D  F0 2C              BEQ XX066B
00312  143F              ;********************************
00313  143F              ; CHECK DIRECTORY COMMAND $
00314  143F              ;********************************
00315  143F  C9 24              CMP #$24        ;'$'






DOS 4.1E DISK WEDGE......PAGE 0014

LINE# LOC   CODE        LINE


00316  1441  F0 4A              BEQ XX068D
00317  1443              ;********************************
00318  1443              ; CHECK STATUS COMMAND ONLY
00319  1443              ;********************************
00320  1443  D0 08              BNE XX064D
00321  1445              ;********************************
00322  1445              ; NO COMMAND - PASS BACK TO PROCESSING LOOP
00323  1445              ;********************************
00324  1445  4C 79 00    XX0645 JMP RCHRGT
00325  1448              ;********************************
00326  1448              ; NOT OUR COMMAND 
00327  1448              ; RETURN TO CHRGET TO PROCESS COMMAND
00328  1448              ;********************************
00329  1448  A6 9B       XX0648 LDX PRTY        ; RECOVERY X REG
00330  144A  4C 79 00           JMP RCHRGT
00331  144D              ;********************************
00332  144D              ; @ OR / READ DRIVE STATUS
00333  144D              ;********************************
00334  144D  A9 08       XX064D LDA #$08
00335  144F  20 B1 FF           JSR LISTEN
00336  1452  A9 6F              LDA #$6F
00337  1454  20 93 FF           JSR SECOND
00338  1457              ;
00339  1457  E6 7A       XX0657 INC TXTPTR
00340  1459  A0 00              LDY #$00
00341  145B  B1 7A              LDA (TXTPTR),Y
00342  145D  F0 06              BEQ XX0665
00343  145F  20 A8 FF           JSR CIOUT
00344  1462  B8                 CLV 
00345  1463  50 F2              BVC XX0657
00346  1465  20 AE FF    XX0665 JSR UNLSN
00347  1468  B8                 CLV 
00348  1469  50 1F              BVC XX068A
00349  146B              ;
00350  146B  84 7A       XX066B STY TXTPTR
00351  146D  A9 08              LDA #$08
00352  146F  20 B4 FF           JSR TALK
00353  1472  A9 6F              LDA #$6F
00354  1474  20 96 FF           JSR TKSA
00355  1477              ;********************************
00356  1477              ; READ IN STATUS BYTES 00, OK,00,00
00357  1477              ;********************************
00358  1477  20 A5 FF    XX0677 JSR ACPTR
00359  147A  C9 0D              CMP #$0D
00360  147C  F0 06              BEQ XX0684
00361  147E  20 42 E7           JSR KCHROT
00362  1481  B8                 CLV 
00363  1482  50 F3              BVC XX0677
00364  1484  20 42 E7    XX0684 JSR KCHROT
00365  1487  20 AB FF           JSR UNTLK
00366  148A  4C 79 00    XX068A JMP RCHRGT
00367  148D              ;********************************
00368  148D              ; @$ OR /$ LIST DIRECTORY
00369  148D              ;********************************
00370  148D  C8          XX068D INY 






DOS 4.1E DISK WEDGE......PAGE 0015

LINE# LOC   CODE        LINE


00371  148E  B1 7A              LDA (TXTPTR),Y
00372  1490  D0 FB              BNE XX068D
00373  1492  88                 DEY 
00374  1493  98                 TYA 
00375  1494  A2 01              LDX #$01
00376  1496  A0 02              LDY #$02
00377  1498  20 BD FF           JSR SETNAM
00378  149B              ;********************************
00379  149B  A2 08              LDX #$08
00380  149D  A5 9B              LDA PRTY
00381  149F  D0 3E              BNE XX06DF
00382  14A1              ;
00383  14A1  A9 0E              LDA #$0E
00384  14A3  A0 60              LDY #$60
00385  14A5  20 BA FF           JSR SETLFS
00386  14A8              ;********************************
00387  14A8  20 C0 FF           JSR OPEN
00388  14AB              ;********************************
00389  14AB  A9 08              LDA #$08
00390  14AD  20 B4 FF           JSR TALK
00391  14B0  A9 60              LDA #$60
00392  14B2  20 96 FF           JSR TKSA
00393  14B5  A9 00              LDA #$00
00394  14B7  85 90              STA STATUS
00395  14B9  A0 03              LDY #$03
00396  14BB              ;********************************
00397  14BB  84 B7       RFILNM STY $B7
00398  14BD  20 A5 FF           JSR ACPTR
00399  14C0  85 B0              STA $B0
00400  14C2  A4 90              LDY STATUS
00401  14C4  D0 1B              BNE XX06E1
00402  14C6              ;********************************
00403  14C6  20 A5 FF           JSR ACPTR
00404  14C9  85 B1              STA $B1
00405  14CB  A4 90              LDY STATUS
00406  14CD  D0 12              BNE XX06E1
00407  14CF              ;********************************
00408  14CF  A4 B7              LDY $B7
00409  14D1  88                 DEY 
00410  14D2  D0 E7              BNE RFILNM
00411  14D4              ;********************************
00412  14D4  A6 B0              LDX $B0
00413  14D6  A5 B1              LDA $B1
00414  14D8  20 CD DD           JSR PRTLIN
00415  14DB  A9 20              LDA #$20        ;' '
00416  14DD  D0 06              BNE XX06E5
00417  14DF              ;********************************
00418  14DF  D0 40       XX06DF BNE LOADIT
00419  14E1              ;********************************
00420  14E1              ; DONE.
00421  14E1              ;********************************
00422  14E1  D0 31       XX06E1 BNE ENDER
00423  14E3              ;********************************
00424  14E3              ; LOOP BACK TO READ MORE CHARACTERS
00425  14E3              ;********************************






DOS 4.1E DISK WEDGE......PAGE 0016

LINE# LOC   CODE        LINE


00426  14E3  D0 D6       XX06E3 BNE RFILNM
00427  14E5              ;********************************
00428  14E5              ;
00429  14E5              ;********************************
00430  14E5  20 D2 FF    XX06E5 JSR CHROUT
00431  14E8  20 A5 FF    XX06E8 JSR ACPTR
00432  14EB  A6 90              LDX STATUS
00433  14ED  D0 25              BNE ENDER
00434  14EF              ;********************************
00435  14EF  C9 00              CMP #$00
00436  14F1  F0 18              BEQ XX070B
00437  14F3  20 D2 FF           JSR CHROUT
00438  14F6  20 E1 FF           JSR STOP
00439  14F9  F0 19              BEQ ENDER
00440  14FB              ;********************************
00441  14FB  20 E4 FF           JSR GETIN
00442  14FE  F0 E8              BEQ XX06E8
00443  1500  C9 20              CMP #$20        ;' '
00444  1502  D0 E4              BNE XX06E8
00445  1504  20 E4 FF    XX0704 JSR GETIN
00446  1507  F0 FB              BEQ XX0704
00447  1509  D0 DD              BNE XX06E8
00448  150B  A9 0D       XX070B LDA #$0D
00449  150D  20 D2 FF           JSR CHROUT
00450  1510  A0 02              LDY #$02
00451  1512  D0 CF              BNE XX06E3
00452  1514              ;********************************
00453  1514              ; DONE CLOSE CLEAR AND CLOSE CHANNEL
00454  1514              ;********************************
00455  1514  20 CC FF    ENDER  JSR CLRCHN      ;CLEAR I/O CHANNELS
00456  1517  A9 0E              LDA #$0E        ;DRIVE CHANNEL
00457  1519  20 C3 FF           JSR CLOSE       ;CLOSE
00458  151C  68                 PLA             ;PULL RTS ADDRESS
00459  151D  68                 PLA
00460  151E  4C 67 E4           JMP WARMBS
00461  1521              ;********************************
00462  1521              ; /FILENAME - LOAD FILENAME
00463  1521              ;********************************
00464  1521  A9 0E       LOADIT LDA #$0E
00465  1523  A0 00              LDY #$00
00466  1525  20 BA FF           JSR SETLFS
00467  1528  A9 00              LDA #$00
00468  152A  A6 2B              LDX VARTOP
00469  152C  A4 2C              LDY VARTOP+1
00470  152E  20 D5 FF           JSR LOAD
00471  1531              ;********************************
00472  1531              ; BASIC CLEANUP AFTER LOAD
00473  1531              ;********************************
00474  1531  4C 95 E1           JMP CLOAD
00475  1534              ;********************************
00476  1534              ;.END 
